services:
  karakeep-chrome:
    image: gcr.io/zenika-hub/alpine-chrome:124
    container_name: karakeep-chrome
    command:
      - --no-sandbox
      - --disable-gpu
      - --disable-dev-shm-usage
      - --remote-debugging-address=0.0.0.0
      - --remote-debugging-port=9222
      - --hide-scrollbars
    restart: unless-stopped

  karakeep-meilisearch:
    image: docker.io/getmeili/meilisearch:v1.10
    container_name: karakeep-meilisearch
    volumes:
      - karakeep-data:/meili_data
    environment:
      MEILI_MASTER_KEY: ${MEILI_MASTER_KEY}
    restart: unless-stopped

  karakeep:
    image: ghcr.io/karakeep-app/karakeep:release
    container_name: karakeep
    ports:
      - "3322:3000"
    volumes:
      - karakeep-app-data:/data
    environment:
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET}
      NEXTAUTH_URL: ${NEXTAUTH_URL}
      DATA_DIR: /data
      MEILI_ADDR: http://karakeep-meilisearch:7700
      MEILI_MASTER_KEY: ${MEILI_MASTER_KEY}
      BROWSER_WEB_URL: http://karakeep-chrome:9222
    depends_on:
      - karakeep-meilisearch
      - karakeep-chrome
    restart: unless-stopped

  karakeep-homedash:
    image: ghcr.io/codejawn/karakeep-homedash:latest
    container_name: karakeep-homedash
    ports:
      - "8595:8595"
    volumes:
      - karakeep-app-data:/mnt/karakeep-data:ro
      - karakeep-homedash-config:/app/config
    command:
      - /bin/sh
      - -c
      - ln -sf /mnt/karakeep-data/db.db /app/db.db && python3 server.py
    environment:
      KARAKEEP_URL: ${NEXTAUTH_URL}
    depends_on:
      - karakeep
    restart: unless-stopped

volumes:
  karakeep-data:
    external: true
    name: karakeep-data
  karakeep-app-data:
    external: true
    name: karakeep-app-data
  karakeep-homedash-config:
    external: true
    name: karakeep-homedash-config


